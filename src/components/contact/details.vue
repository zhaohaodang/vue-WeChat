<template>
  <!--  通讯录朋友信息-->
  <div class="profile">
    <header id="wx-header">
      <div class="center">
        <router-link to="/contact" tag="div" class="iconfont icon-return-arrow">
          <span>通讯录</span>
        </router-link>
        <span>详细资料</span>
      </div>
    </header>
    <div class="weui-cells">
      <div class="weui-cell">
        <div class="weui-cell__hd"><img :src="userInfo.headerUrl" alt="" class="self-header" style="width:60px">
        </div>
        <div class="weui-cell__bd">
          <h4 class="self-nickname">{{ userInfo.nickname }}<span class="gender"
                                                                 :class="[userInfo.sex===1?'gender-male':'gender-female']"></span>
          </h4>
          <p class="self-wxid" style="font-size: 13px;color: #999;">微信号: {{ userInfo.wxid }}</p>
          <p class="nickname" style="font-size: 13px;color: #999;">昵称:{{ userInfo.nickname || '无' }}</p>
        </div>
      </div>
    </div>
    <div class="weui-cells">
      <div class="weui-cell weui-cell_access">
        <div class="weui-cell__bd">
          <p>设置备注和标签</p>
        </div>
        <div class="weui-cell__ft">

        </div>
      </div>
    </div>
    <div class="weui-cells">
      <div class="weui-cell">
        <div class="weui-cell__bd">
          <p>地区</p>
        </div>
        <div class="weui-cell__ft" style="flex: 4;text-align: left;">
          <span v-for="(item,index) in userInfo.area" :key="index">{{ item }}&nbsp;&nbsp;&nbsp;</span>
        </div>
      </div>
      <div class="weui-cell weui-cell_access">
        <div class="weui-cell__bd">
          <p>个人相册</p>
        </div>
        <div class="weui-cell__ft" style="flex: 4;text-align: left;">
          <div class="album-list">
            <img :src="item.imgSrc" style="width:50px;margin:0 5px" :key="index" alt=""
                 v-for="(item,index) in userInfo.album" />
          </div>
        </div>
      </div>
      <div class="weui-cell weui-cell_access">
        <div class="weui-cell__bd">
          <p>更多</p>
        </div>
        <div class="weui-cell__ft">

        </div>
      </div>
    </div>

    <a :href="chatUrl" class="weui-btn weui-btn_primary"
       style="width:90%;margin-top:20px;">发消息</a>
    <a href="javascript:" class="weui-btn weui-btn_default" style="width:90%">视频</a>

  </div>
</template>
<script>
import contact from "../../vuex/contacts"

export default {
  data() {
    return {
      pageName: ""
    }
  },
  computed: {
    // 当前用户信息
    userInfo() {
      return contact.getUserInfo(this.$route.query.wxid)
    },
    // 消息
    msgMid() {
      for (let i in this.$store.state.msgList.baseMsg) {
        // 不要将==改为===
        if (this.$store.state.msgList.baseMsg[i].user.length == 1 && this.$store.state.msgList.baseMsg[i].user[0] == contact.getUserInfo(this.$route.query.wxid)) {
          return this.$store.state.msgList.baseMsg[i].mid
        }
      }
      return 1
    },
    // 检查与好友是否存在聊天记录，没有则添加新的聊天，有则跳转
    chatUrl() {
      let isHaveChat = false
      for(let i in this.$store.state.msgList.baseMsg) {
        if (this.$store.state.msgList.baseMsg[i].user.length == 1 && this.$store.state.msgList.baseMsg[i].user[0] == contact.getUserInfo(this.$route.query.wxid)) {
          isHaveChat = true
        }
      }
      if(!isHaveChat) {
        this.addChatList()
      }
      return "#/wechat/dialogue?mid=" + this.msgMid + "&name=" + this.userInfo.nickname + "&group_num=1"
    }
  },
  methods: {
    // 添加聊天到聊天列表
    addChatList() {
      this.$store.commit('addChatList', this.userInfo)
    }
  }
}
</script>
<style>

</style>
